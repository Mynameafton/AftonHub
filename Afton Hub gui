-- สร้าง ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MyGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- ปุ่มเปิด/ปิด GUI
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 100, 0, 30)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.Text = "Show GUI"
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
toggleButton.TextScaled = true
toggleButton.Font = Enum.Font.GothamBold
toggleButton.Parent = screenGui

-- สร้างหน้าต่าง GUI หลัก
local background = Instance.new("Frame")
background.Size = UDim2.new(0, 300, 0, 250)
background.Position = UDim2.new(0.5, -150, 0.5, -125)
background.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
background.Active = true
background.Draggable = true
background.Visible = false
background.Parent = screenGui

-- หัวข้อ
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Text = "MY NAME AFTON"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.Parent = background

-- ช่องกรอก Speed
local speedBox = Instance.new("TextBox")
speedBox.PlaceholderText = "Enter Speed"
speedBox.Size = UDim2.new(0.8, 0, 0, 40)
speedBox.Position = UDim2.new(0.1, 0, 0.25, 0)
speedBox.Text = ""
speedBox.Font = Enum.Font.Gotham
speedBox.TextScaled = true
speedBox.ClearTextOnFocus = false
speedBox.Parent = background

-- ปุ่มปรับ Speed
local speedBtn = Instance.new("TextButton")
speedBtn.Text = "Set Speed"
speedBtn.Size = UDim2.new(0.8, 0, 0, 30)
speedBtn.Position = UDim2.new(0.1, 0, 0.42, 0)
speedBtn.Font = Enum.Font.GothamBold
speedBtn.TextScaled = true
speedBtn.Parent = background

-- ช่องกรอก JumpPower
local jumpBox = Instance.new("TextBox")
jumpBox.PlaceholderText = "Enter JumpPower"
jumpBox.Size = UDim2.new(0.8, 0, 0, 40)
jumpBox.Position = UDim2.new(0.1, 0, 0.58, 0)
jumpBox.Text = ""
jumpBox.Font = Enum.Font.Gotham
jumpBox.TextScaled = true
jumpBox.ClearTextOnFocus = false
jumpBox.Parent = background

-- ปุ่มปรับ JumpPower
local jumpBtn = Instance.new("TextButton")
jumpBtn.Text = "Set Jump"
jumpBtn.Size = UDim2.new(0.8, 0, 0, 30)
jumpBtn.Position = UDim2.new(0.1, 0, 0.75, 0)
jumpBtn.Font = Enum.Font.GothamBold
jumpBtn.TextScaled = true
jumpBtn.Parent = background

-- ปุ่ม Fly
local flyBtn = Instance.new("TextButton")
flyBtn.Text = "Fly"
flyBtn.Size = UDim2.new(0.8, 0, 0, 30)
flyBtn.Position = UDim2.new(0.1, 0, 0.9, 0)
flyBtn.Font = Enum.Font.GothamBold
flyBtn.TextScaled = true
flyBtn.Parent = background

-- ทำงานปุ่ม Speed
speedBtn.MouseButton1Click:Connect(function()
	local speed = tonumber(speedBox.Text)
	if speed and game.Players.LocalPlayer.Character then
		game.Players.LocalPlayer.Character:WaitForChild("Humanoid").WalkSpeed = speed
	end
end)

-- ทำงานปุ่ม Jump
jumpBtn.MouseButton1Click:Connect(function()
	local jump = tonumber(jumpBox.Text)
	if jump and game.Players.LocalPlayer.Character then
		game.Players.LocalPlayer.Character:WaitForChild("Humanoid").JumpPower = jump
	end
end)

-- เปิด/ปิด GUI
local guiVisible = false
toggleButton.MouseButton1Click:Connect(function()
	guiVisible = not guiVisible
	background.Visible = guiVisible
	toggleButton.Text = guiVisible and "Hide GUI" or "Show GUI"
end)

-- ระบบบิน
local flying = false
local currentDir = Vector3.new(0, 0, 0)
local activeBtns = {}
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

local velocity = Instance.new("BodyVelocity")
velocity.MaxForce = Vector3.new(1e5, 1e5, 1e5)
velocity.Velocity = Vector3.new(0, 0, 0)
velocity.P = 1250

local gyro = Instance.new("BodyGyro")
gyro.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
gyro.P = 3000
gyro.CFrame = humanoidRootPart.CFrame

-- ปุ่มควบคุมมือถือ
local controlFrame = Instance.new("Frame")
controlFrame.Size = UDim2.new(0, 150, 0, 150)
controlFrame.Position = UDim2.new(1, -160, 1, -160)
controlFrame.BackgroundTransparency = 1
controlFrame.Parent = screenGui
controlFrame.Visible = false

local function createControlBtn(name, text, pos, dir)
	local btn = Instance.new("TextButton")
	btn.Name = name
	btn.Size = UDim2.new(0, 50, 0, 50)
	btn.Position = pos
	btn.Text = text
	btn.TextScaled = true
	btn.Font = Enum.Font.GothamBold
	btn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
	btn.Parent = controlFrame
	btn.AutoButtonColor = true
	return btn, dir
end

local controls = {}
controls["Up"] = {btn = createControlBtn("UpBtn", "↑", UDim2.new(0.33, 0, 0, 0), Vector3.new(0, 1, 0))}
controls["Down"] = {btn = createControlBtn("DownBtn", "↓", UDim2.new(0.33, 0, 1, -50), Vector3.new(0, -1, 0))}
controls["Left"] = {btn = createControlBtn("LeftBtn", "←", UDim2.new(0, 0, 0.33, 0), Vector3.new(-1, 0, 0))}
controls["Right"] = {btn = createControlBtn("RightBtn", "→", UDim2.new(1, -50, 0.33, 0), Vector3.new(1, 0, 0))}
controls["Forward"] = {btn = createControlBtn("ForwardBtn", "Fwd", UDim2.new(0.33, 0, 0.33, 0), Vector3.new(0, 0, -1))}
controls["Back"] = {btn = createControlBtn("BackBtn", "Back", UDim2.new(0.33, 0, 0.66, 0), Vector3.new(0, 0, 1))}

local function updateDir()
	local newDir = Vector3.new(0, 0, 0)
	for _, data in pairs(activeBtns) do
		newDir += data
	end
	currentDir = newDir
end

for name, info in pairs(controls) do
	local btn = info.btn
	btn.MouseButton1Down:Connect(function()
		activeBtns[name] = info[2]
		updateDir()
	end)
	btn.MouseButton1Up:Connect(function()
		activeBtns[name] = nil
		updateDir()
	end)
end

flyBtn.MouseButton1Click:Connect(function()
	flying = not flying
	if flying then
		flyBtn.Text = "Unfly"
		controlFrame.Visible = true
		humanoid.PlatformStand = true
		velocity.Parent = humanoidRootPart
		gyro.Parent = humanoidRootPart
		game:GetService("RunService"):BindToRenderStep("Fly", Enum.RenderPriority.Input.Value, function()
			local camCF = workspace.CurrentCamera.CFrame
			local direction = camCF:VectorToWorldSpace(currentDir) * 50
			velocity.Velocity = direction

			-- หมุนตัวละครตามกล้อง (เฉพาะแนว Y)
			local _, y, _ = camCF:ToEulerAnglesYXZ()
			humanoidRootPart.CFrame = CFrame.new(humanoidRootPart.Position) * CFrame.Angles(0, y, 0)
			gyro.CFrame = camCF
		end)
	else
		flyBtn.Text = "Fly"
		controlFrame.Visible = false
		humanoid.PlatformStand = false
		velocity.Parent = nil
		gyro.Parent = nil
		game:GetService("RunService"):UnbindFromRenderStep("Fly")
		currentDir = Vector3.new(0, 0, 0)
		activeBtns = {}
	end
end)
